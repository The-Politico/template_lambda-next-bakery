{"ast":null,"code":"import _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _Object$getPrototypeOf from \"@babel/runtime-corejs2/core-js/object/get-prototype-of\";\nimport _Object$setPrototypeOf from \"@babel/runtime-corejs2/core-js/object/set-prototype-of\";\nimport _Object$create from \"@babel/runtime-corejs2/core-js/object/create\";\nimport _Object$assign from \"@babel/runtime-corejs2/core-js/object/assign\";\nimport _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport './index.css';\nimport React from 'react';\nimport classnames from 'classnames';\nimport PropTypes from 'prop-types';\nimport Loader from 'react-loader-spinner';\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n\n    _Object$defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _extends() {\n  _extends = _Object$assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = _Object$create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = _Object$setPrototypeOf ? _Object$getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || _Object$getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = _Object$setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nvar sleep = function (duration) {\n  return function () {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return new _Promise(function (resolve) {\n      setTimeout(function () {\n        return resolve.apply(void 0, args);\n      }, duration);\n    });\n  };\n};\n\nvar styles = {\n  \"fill-politico-red\": \"politico_style_sketch___2g-9qMwfV2\",\n  \"courier\": \"politico_style_sketch___xOWldu0Cp3\",\n  \"fancy-serif\": \"politico_style_sketch___RSh8SgYyMF\",\n  \"styles\": \"politico_style_sketch___3uBRO1g3_s\",\n  \"spinAround\": \"politico_style_sketch___2uE1q-OS8P\"\n};\n\nvar ImageUpload =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(ImageUpload, _React$Component);\n\n  function ImageUpload(props) {\n    var _this;\n\n    _classCallCheck(this, ImageUpload);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ImageUpload).call(this, props));\n    _this.state = {\n      previewToggled: true,\n      inputToggled: props.value === '',\n      inputProps: {\n        value: props.value\n      }\n    };\n    _this.dndHandler = {\n      enter: function enter(e) {\n        _this.references.dnd.current.className = classnames('dnd', {\n          hover: true\n        });\n        e.stopPropagation();\n        e.preventDefault();\n      },\n      over: function over(e) {\n        e.stopPropagation();\n        e.preventDefault();\n      },\n      leave: function leave(e) {\n        _this.references.dnd.current.className = classnames('dnd', {\n          hover: false\n        });\n        e.stopPropagation();\n        e.preventDefault();\n      },\n      drop: function drop(e) {\n        if (e.dataTransfer.files.length > 1) {\n          alert('Import is limited to a single file.');\n        } else {\n          _this.handleUpload(e.dataTransfer.files[0]);\n        }\n\n        e.stopPropagation();\n        e.preventDefault();\n      }\n    };\n    _this.references = {\n      'dnd': React.createRef()\n    };\n    _this.parseInputProps = _this.parseInputProps.bind(_assertThisInitialized(_this));\n    _this.toggleInputToggled = _this.toggleInputToggled.bind(_assertThisInitialized(_this));\n    _this.uploadUrl = _this.uploadUrl.bind(_assertThisInitialized(_this));\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_this));\n    _this.handleUpload = _this.handleUpload.bind(_assertThisInitialized(_this));\n    _this.getImage = _this.getImage.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(ImageUpload, [{\n    key: \"parseInputProps\",\n    value: function parseInputProps(props) {\n      var inputProps = _Object$assign({}, props);\n\n      delete inputProps.help;\n      delete inputProps.label;\n      delete inputProps.wrapperClassName;\n      delete inputProps.size;\n      delete inputProps.compression;\n      delete inputProps.progressive;\n      delete inputProps.onUpload;\n      delete inputProps.onChange;\n      delete inputProps.onDelete;\n      this.setState({\n        inputProps: inputProps\n      });\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(props) {\n      this.parseInputProps(props);\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.parseInputProps(this.props);\n    }\n  }, {\n    key: \"toggleInputToggled\",\n    value: function toggleInputToggled() {\n      this.props.onDelete();\n      this.setState({\n        inputToggled: !this.state.inputToggled\n      });\n    }\n  }, {\n    key: \"uploadUrl\",\n    value: function uploadUrl() {\n      if (this.props.env === 'staging') {\n        return 'https://staging.politicoapps.com/api/services/s3imageservice/';\n      } else if (this.props.env === 'production') {\n        return 'https://politicoapps.com/api/services/s3imageservice/';\n      }\n    }\n  }, {\n    key: \"handleChange\",\n    value: function handleChange(event) {\n      var img = event.target.files[0];\n      this.handleUpload(img);\n    }\n  }, {\n    key: \"handleUpload\",\n    value: function handleUpload(img) {\n      var _this2 = this;\n\n      var confirmed = confirm(\"Are you sure you want to upload \".concat(img.name, \"?\"));\n      this.references.dnd.current.className = classnames('dnd', {\n        hover: false\n      });\n\n      if (confirmed) {\n        var formData = new FormData();\n        formData.append('img', img);\n\n        if (this.props.size) {\n          formData.append('sizes', \"[\".concat(this.props.size, \"]\"));\n        }\n\n        if (this.props.compression) {\n          formData.append('compression', this.props.compression);\n        }\n\n        if (this.props.progressive) {\n          formData.append('progressive', this.props.progressive);\n        }\n\n        fetch(this.uploadUrl(), {\n          method: 'POST',\n          headers: {\n            'Authorization': \"Token \".concat(this.props.token)\n          },\n          body: formData\n        }).then(function (resp) {\n          return resp.json();\n        }).then(function (d) {\n          var canonicalUrl = d.canonical;\n          var cacheUrl = d.urls[0];\n\n          _this2.setState({\n            inputToggled: false,\n            previewToggled: false\n          });\n\n          _this2.getImage(canonicalUrl, cacheUrl, 500);\n        }).catch(function (error) {\n          return console.error(\"Image Service Error =\\n\", error);\n        });\n      }\n\n      this.props.onChange(img);\n    }\n  }, {\n    key: \"getImage\",\n    value: function getImage(canonicalUrl, cacheUrl) {\n      var _this3 = this;\n\n      var intervalTime = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 500;\n      var limit = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 10;\n      return fetch(canonicalUrl, {\n        method: 'GET',\n        mode: 'no-cors'\n      }).then(sleep(intervalTime)).then(function (resp) {\n        if (!resp.ok && limit >= 0) {\n          return _this3.getImage(canonicalUrl, cacheUrl, intervalTime, --limit);\n        } else {\n          _this3.props.onUpload({\n            canonicalUrl: canonicalUrl,\n            cacheUrl: cacheUrl\n          });\n\n          _this3.setState({\n            previewToggled: true\n          });\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        id: \"\".concat(this.props.id, \"-container\"),\n        className: classnames('s3-image-service', this.props.wrapperClassName, styles.styles)\n      }, this.props.label.length > 0 && React.createElement(\"label\", {\n        id: \"label-\".concat(this.props.id),\n        className: \"label\"\n      }, this.props.label), this.state.inputToggled && React.createElement(\"input\", _extends({\n        type: \"file\",\n        onChange: this.handleChange\n      }, this.state.inputProps)), this.state.inputToggled && React.createElement(\"label\", {\n        ref: this.references.dnd,\n        className: classnames('dnd', {\n          error: this.props.error\n        }),\n        htmlFor: this.props.id,\n        onDragEnter: this.dndHandler.enter,\n        onDragOver: this.dndHandler.over,\n        onDragLeave: this.dndHandler.leave,\n        onDrop: this.dndHandler.drop\n      }, React.createElement(\"svg\", {\n        className: \"icon\",\n        xmlns: \"http://www.w3.org/2000/svg\",\n        viewBox: \"0 0 691 691\"\n      }, React.createElement(\"rect\", {\n        x: \"6.5\",\n        y: \"6.5\",\n        width: \"678\",\n        height: \"678\",\n        rx: \"17\",\n        ry: \"17\"\n      }), React.createElement(\"path\", {\n        d: \"M390,470,507.21,271.72c4.76-8,9.78-15.19,11.16-15.87s7.72,7.9,12.32,16L684,543\"\n      }), React.createElement(\"path\", {\n        d: \"M7,482,196.11,146.1a5.7,5.7,0,0,1,9.86,0L515.58,682\"\n      }), React.createElement(\"circle\", {\n        cx: \"455\",\n        cy: \"129\",\n        r: \"66.5\"\n      }), React.createElement(\"path\", {\n        d: \"M296,306.5l-48.74,59.95a1.67,1.67,0,0,1-2.6.07l-46.32-51a1.83,1.83,0,0,0-2.72,0l-38.24,40.1a1.86,1.86,0,0,1-2.74,0L109,306\"\n      }))), !this.state.inputToggled && React.createElement(\"div\", {\n        className: \"preview\"\n      }, this.state.previewToggled && React.createElement(\"img\", {\n        className: \"image-preview\",\n        src: this.props.value\n      }), this.state.previewToggled && React.createElement(\"div\", {\n        className: \"delete-container\"\n      }, React.createElement(\"div\", {\n        className: \"delete\",\n        onClick: this.toggleInputToggled\n      }, React.createElement(\"svg\", {\n        xmlns: \"http://www.w3.org/2000/svg\",\n        viewBox: \"0 0 220 240.07\"\n      }, React.createElement(\"path\", {\n        d: \"M20,60.06H6.81C1.56,60,0,58.47,0,53.16c0-2.33,0-4.66,0-7,0-4.31,1.76-6,6.11-6,14.83,0,29.66-.06,44.49,0,2.11,0,3-.7,3.79-2.56,3.09-7.63,6.2-15.26,9.54-22.79C68.11,5.39,75.53.31,85.81.16q24.12-.33,48.24,0c10.39.13,17.86,5.23,22.07,14.76,3.35,7.61,6.5,15.31,9.64,23A3,3,0,0,0,169,40.15c14.75-.08,29.5,0,44.24,0,5.2,0,6.73,1.53,6.74,6.68,0,2.41,0,4.83,0,7.24-.06,4.19-1.76,6-5.92,6-4.58.06-9.15,0-14.08,0v3q0,72,0,144c0,10.16-2.81,19.16-10.11,26.53A21,21,0,0,1,174.43,240q-64.74,0-129.47,0c-10.21,0-16.5-6.16-21.06-14.51-3-5.55-3.9-11.6-3.9-17.85q0-49.36,0-98.73Zm20,.08v2.73q0,45.62,0,91.23,0,26.49,0,53c0,4,.57,7.88,3.09,11.08A5.42,5.42,0,0,0,46.75,220q63.24.14,126.48.11a4.26,4.26,0,0,0,3.91-2.12A19,19,0,0,0,180,207.09q0-72.48,0-145c0-.64-.09-1.27-.14-2ZM75,40h70c-2.52-6.1-4.83-12-7.5-17.83a4.73,4.73,0,0,0-3.63-2q-23.85-.21-47.71,0A4.54,4.54,0,0,0,82.68,22C80,27.87,77.57,33.87,75,40Z\"\n      }), React.createElement(\"path\", {\n        d: \"M80,140.1q0,21.61,0,43.22c0,5.11-1.61,6.72-6.71,6.73-2.58,0-5.17.08-7.75,0-3.73-.14-5.49-1.9-5.49-5.65q0-44.35,0-88.7c0-3.71,1.82-5.47,5.57-5.56,2.83-.07,5.66-.05,8.49,0,4.15.07,5.88,1.81,5.89,6Q80,118.12,80,140.1Z\"\n      }), React.createElement(\"path\", {\n        d: \"M100,139.83v-43c0-5.17,1.55-6.74,6.66-6.75,2.41,0,4.83,0,7.24,0,4.33,0,6.06,1.75,6.07,6.1q0,19.61,0,39.22,0,23.87,0,47.72c0,5.3-1.56,6.89-6.78,6.9-2.33,0-4.67,0-7,0-4.47-.05-6.18-1.76-6.19-6.25Q100,161.82,100,139.83Z\"\n      }), React.createElement(\"path\", {\n        d: \"M140,140.1q0-21.61,0-43.23c0-5.18,1.55-6.75,6.65-6.76,2.49,0,5,0,7.49,0,4,.07,5.8,1.81,5.82,5.83,0,9.08,0,18.16,0,27.23q0,30,0,60c0,5.42-1.53,6.92-7,6.92-2.25,0-4.5,0-6.75,0-4.47-.05-6.19-1.75-6.19-6.23Q140,162,140,140.1Z\"\n      })))), !this.state.previewToggled && React.createElement(Loader, {\n        type: \"Oval\",\n        color: \"#9e0000\",\n        height: \"50\",\n        width: \"50\"\n      })), this.state.inputToggled && this.props.help.length > 0 && React.createElement(\"p\", {\n        id: \"help-\".concat(this.props.id),\n        className: classnames('help', {\n          error: this.props.error\n        })\n      }, this.props.help));\n    }\n  }]);\n\n  return ImageUpload;\n}(React.Component);\n\nImageUpload.defaultProps = {\n  id: '',\n  className: '',\n  wrapperClassName: '',\n  env: 'production',\n  value: '',\n  label: '',\n  help: '',\n  onChange: function onChange() {},\n  onUpload: function onUpload() {},\n  onDelete: function onDelete() {}\n};\nImageUpload.propTypes = {\n  id: PropTypes.string.isRequired,\n  className: PropTypes.string,\n  wrapperClassName: PropTypes.string,\n  env: PropTypes.oneOf(['production', 'staging']),\n  value: PropTypes.string,\n  label: PropTypes.string,\n  help: PropTypes.string,\n  size: PropTypes.number,\n  compression: PropTypes.bool,\n  progressive: PropTypes.bool,\n  onChange: PropTypes.func,\n  onUpload: PropTypes.func,\n  onDelete: PropTypes.func\n};\nexport default ImageUpload;","map":null,"metadata":{},"sourceType":"module"}